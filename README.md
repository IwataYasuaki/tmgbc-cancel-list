# 東京都スポーツ施設キャンセル待ちツール

[東京都スポーツ施設サービス](https://yoyaku.sports.metro.tokyo.lg.jp/user/view/user/homeIndex.html) のキャンセル待ちをするツール。1分おきに指定された施設、日付、時間帯の空き状況を確認し、空いていれば予約する。ずっと空かないまま指定された日付を迎えたら処理を終了する。

## 使い方

1. ローカルで [docker](https://www.docker.com/) を使えるようにしておく

1. 本リポジトリをローカルにクローンする

    ```
    git clone https://github.com/IwataYasuaki/tmgbc-cancel-list.git
    ```

1. クローンしたディレクトリへ移動する

    ```
    cd tmgbc-cancel-list
    ```

1. コンテナを起動する

    ```
    docker-compose up -d
    ```

1. コンテナに入る

    ```
    docker-compose exec python bash
    ```

1. ディレクトリを移動する

    ```
    cd tmgbc-cancel-list/
    ```

1. アプリケーションを実行する

    ```
    python main.py
    ```

1. いろいろ質問されるので答える

    ```
    ユーザーID (登録番号): 
    パスワード:
    公園 (上記から番号を選択):
    年月日 (yyyymmdd):
    種目 (上記から番号を選択):
    時間帯 (上記から番号を選択):
    ```

1. 1分おきにログが出力される

    ```
    2023-11-05 22:55:11.578252+09:00 空いていません: 申込不可
    2023-11-05 22:56:12.056942+09:00 空いていません: 申込不可
    2023-11-05 22:57:12.526715+09:00 空いていません: 申込不可
    ...
    ```

1. 以下のいずれかの結果が出力される

    - 予約できた場合
        ```
        2023-11-05 22:53:39.170812+09:00 空きました
        2023-11-05 22:53:39.170812+09:00 予約が完了しました: 舎人公園, 2023-11-20, 9:00
        処理を終了します
        ```

    - 予約できないまま当日になった場合
        ```
        2023-11-05 22:52:30.878142+09:00 入力された年月日を迎えました: 2023-11-04
        処理を終了します
        ```

    - 何らかのエラーになった場合
        ```
        処理を終了します
        (エラー発生時のbodyの内容)
        (スタックトレース)
        ```

1. 終わったらコンテナから抜ける

    ```
    exit
    ```

1. コンテナを停止させる

    ```
    docker-compose down
    ```

## 注意点

- Apple Silicon搭載のMacの場合、事前にRosetta 2をインストールしておく必要があります ([参考ページ](https://www.sria.co.jp/blog/2023/06/7308/))
    - [Seleniumのdockerイメージ](https://hub.docker.com/u/selenium)がlinux/amd64のみ対応のため
- アプリケーションの実行中にエラーが発生した場合、その時のスクリーンショットを現在のディレクトリに出力します

## TODO
- 予約完了メール通知